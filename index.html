<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyGo Invoice | Final Fix</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* --- LAYOUT RESET --- */
        body { 
            margin: 0; padding: 0; height: 100vh; overflow: hidden; 
            display: flex; background: #1e293b; 
            font-family: sans-serif;
        }

        /* --- LEFT PANEL: EDITOR --- */
        #form-panel {
            width: 360px; min-width: 360px;
            background: #0f172a; color: white;
            height: 100%; overflow-y: auto;
            border-right: 1px solid #334155;
            z-index: 50; padding: 20px;
            box-shadow: 5px 0 15px rgba(0,0,0,0.3);
        }

        /* --- RIGHT PANEL: PREVIEW --- */
        #preview-panel {
            flex-grow: 1; height: 100%;
            overflow-y: auto; background: #64748b;
            padding: 40px; display: flex; justify-content: center; align-items: flex-start;
        }

        /* --- PRINT SETTINGS --- */
        @media print {
            @page { margin: 0; size: A4; }
            body { background: white; display: block; height: auto; overflow: visible; }
            #form-panel { display: none !important; }
            #preview-panel { padding: 0; background: white; width: 100%; height: auto; display: block; }
            .invoice-page { margin: 0 !important; box-shadow: none !important; page-break-after: always; }
        }

        /* --- INVOICE GEOMETRY (A4) --- */
        .invoice-page {
            width: 210mm; height: 296mm; /* Safe A4 height */
            background: white; position: relative;
            margin-bottom: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.5);
            box-sizing: border-box; overflow: hidden;
        }

        /* The Outer White Margin (Safety Zone) */
        .outer-pad {
            width: 100%; height: 100%;
            padding: 10mm; /* 10mm white space all around */
            box-sizing: border-box;
        }

        /* The Black Border Box */
        .border-box {
            width: 100%; height: 100%;
            border: 2px solid black;
            display: flex; flex-direction: column;
            justify-content: space-between; /* Pushes Footer Down */
            padding: 8mm 10mm 5mm 10mm; /* Top Side BottomLeft BottomRight */
            box-sizing: border-box;
        }

        /* --- TYPOGRAPHY --- */
        .font-cinzel { font-family: 'Cinzel', serif; font-weight: 700; }
        .font-playfair { font-family: 'Playfair Display', serif; font-weight: 700; }

        /* --- TABLE --- */
        table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        th, td { border: 2px solid black; padding: 0 8px; vertical-align: middle; }
        th { background: #f3f4f6; height: 35px; font-family: 'Cinzel', serif; font-size: 11pt; }
        
        /* STRICT ROW HEIGHT: 42px * 10 rows = 420px */
        tr.data-row { height: 42px; font-family: 'Playfair Display', serif; font-size: 11pt; }
        
        /* --- UTILS --- */
        .input-dark { 
            background: #1e293b; border: 1px solid #334155; 
            padding: 8px; width: 100%; font-size: 13px; 
            border-radius: 4px; color: white; margin-bottom: 10px; 
        }
        .input-dark:focus { outline: none; border-color: #3b82f6; }
        .lbl { font-size: 10px; text-transform: uppercase; color: #94a3b8; font-weight: bold; display: block; margin-bottom: 4px; }

    </style>
</head>
<body>

    <div id="form-panel">
        <h2 class="text-2xl font-bold text-blue-400 mb-6 font-cinzel tracking-wider border-b border-gray-700 pb-2">EasyGo Editor</h2>

        <label class="lbl">Invoice Number</label>
        <input type="text" id="inNo" value="EG00001" oninput="render()" class="input-dark">
        
        <label class="lbl">Date Issued</label>
        <input type="text" id="inDate" value="17 Dec 2026" oninput="render()" class="input-dark">
        
        <label class="lbl">Customer Name</label>
        <input type="text" id="inTo" placeholder="Enter Client Name" oninput="render()" class="input-dark">
        
        <label class="lbl">Address</label>
        <textarea id="inAddr" oninput="render()" rows="2" placeholder="Enter Client Address" class="input-dark"></textarea>

        <div class="mt-6 border-t border-gray-700 pt-4">
            <div class="flex justify-between items-end mb-2">
                <label class="lbl text-blue-400 text-xs">Line Items</label>
                <button onclick="resetItems()" class="text-[10px] text-red-400 hover:text-red-300 underline">Clear All</button>
            </div>
            
            <div id="items-container" class="space-y-2 mb-4">
                </div>
            
            <button onclick="addItem()" class="w-full bg-slate-700 hover:bg-slate-600 text-white py-2 rounded text-xs font-bold transition uppercase tracking-wider mb-8">
                + Add New Item
            </button>
        </div>

        <button onclick="window.print()" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-4 rounded shadow-xl uppercase tracking-widest text-sm fixed-bottom">
            Print Invoice
        </button>
    </div>

    <div id="preview-panel">
        <div id="pages-wrapper">
            </div>
    </div>

    <datalist id="presets">
        <option value="Veg Momos [39 pcs]">
        <option value="Paneer Momos [39 pcs]">
        <option value="Cheese Corn Momos [36 pcs]">
        <option value="Mini Samosa [33 pcs]">
        <option value="Cheese Balls [39 pcs]">
        <option value="Cheese Corn Nuggets [33 pcs]">
        <option value="French Fries [2.5 Kg]">
    </datalist>

    <script>
        // --- CONSTANTS ---
        const PRESETS = {
            "Veg Momos [39 pcs]": 120, "Paneer Momos [39 pcs]": 165,
            "Cheese Corn Momos [36 pcs]": 150, "Mini Samosa [33 pcs]": 250,
            "Cheese Balls [39 pcs]": 630, "Cheese Corn Nuggets [33 pcs]": 680,
            "French Fries [2.5 Kg]": 250
        };

        // Initialize with one empty row
        let items = [{ desc: "", qty: "", rate: "" }];

        // --- RENDER FORM INPUTS ---
        function renderItemsInput() {
            const container = document.getElementById('items-container');
            container.innerHTML = '';
            items.forEach((item, idx) => {
                container.innerHTML += `
                    <div class="group relative bg-slate-800 p-2 rounded border border-slate-700">
                        <div class="absolute -left-2 top-2 bg-slate-900 text-[10px] text-slate-500 px-1 rounded border border-slate-700">${idx+1}</div>
                        <div class="flex gap-2 mb-2">
                            <input list="presets" value="${item.desc}" oninput="updateItem(${idx}, 'desc', this.value)" class="bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs text-white w-full outline-none focus:border-blue-500" placeholder="Description">
                            <button onclick="delItem(${idx})" class="text-red-500 hover:text-white px-2">√ó</button>
                        </div>
                        <div class="flex gap-2">
                            <input value="${item.qty}" oninput="updateItem(${idx}, 'qty', this.value)" class="bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs text-white w-1/2 outline-none focus:border-blue-500 text-center" placeholder="Qty">
                            <input type="number" value="${item.rate}" oninput="updateItem(${idx}, 'rate', this.value)" class="bg-slate-900 border border-slate-600 rounded px-2 py-1 text-xs text-white w-1/2 outline-none focus:border-blue-500 text-center" placeholder="Rate">
                        </div>
                    </div>
                `;
            });
            render();
        }

        // --- UPDATE STATE ---
        function updateItem(idx, key, val) {
            items[idx][key] = val;
            if(key === 'desc' && PRESETS[val]) {
                items[idx].rate = PRESETS[val];
                renderItemsInput(); // Re-render to show new rate
            } else {
                render(); // Just update preview
            }
        }

        function addItem() { items.push({desc:"", qty:"", rate:""}); renderItemsInput(); }
        function delItem(idx) { if(items.length > 1) items.splice(idx,1); renderItemsInput(); }
        function resetItems() { items = [{desc:"", qty:"", rate:""}]; renderItemsInput(); }

        // --- MAIN RENDER LOGIC ---
        function render() {
            const wrapper = document.getElementById('pages-wrapper');
            wrapper.innerHTML = '';
            
            // Get Header Data
            const data = {
                no: document.getElementById('inNo').value,
                date: document.getElementById('inDate').value,
                to: document.getElementById('inTo').value,
                addr: document.getElementById('inAddr').value
            };

            // Process Items (Logic: If qty/rate missing, subtotal is 0 but hidden)
            const processedItems = items.map(i => {
                const q = parseFloat(i.qty) || 0;
                const r = parseFloat(i.rate) || 0;
                const hasData = i.desc || i.qty || i.rate; // Check if row is touched
                return { 
                    ...i, 
                    sub: q*r,
                    displayQty: i.qty,
                    displayRate: i.rate ? `‚Çπ ${i.rate}` : '',
                    displaySub: (q && r) ? `‚Çπ ${q*r}` : '',
                    isEmpty: !hasData 
                };
            });

            // Calculate Total (Only valid numbers)
            const total = processedItems.reduce((a,b) => a + b.sub, 0);
            
            // Pagination: Split into chunks of 10
            const chunks = [];
            // If completely empty (initial state), still show 1 page
            if(processedItems.length === 0) chunks.push([]);
            else {
                for(let i=0; i<processedItems.length; i+=10) chunks.push(processedItems.slice(i, i+10));
            }

            // Generate Pages
            chunks.forEach((chunk, pageIdx) => {
                const isLast = pageIdx === chunks.length - 1;
                const pageNum = pageIdx + 1;
                
                let rows = '';
                
                // 1. Render Actual Items
                chunk.forEach((it, i) => {
                    const sn = (pageIdx*10)+i+1;
                    // If row is purely empty (user just cleared it), don't show S.No or garbage
                    const showSn = !it.isEmpty ? sn : '';
                    
                    rows += `
                        <tr class="data-row">
                            <td class="text-center">${showSn}</td>
                            <td>${it.desc}</td>
                            <td class="text-center font-bold font-sans">${it.displayQty}</td>
                            <td class="text-center font-bold font-sans">${it.displayRate}</td>
                            <td class="text-center font-bold font-sans">${it.displaySub}</td>
                        </tr>
                    `;
                });

                // 2. Fill Remaining Empty Rows (To reach 10)
                const remaining = 10 - chunk.length;
                for(let i=0; i < remaining; i++) {
                    rows += `<tr class="data-row"><td></td><td></td><td></td><td></td><td></td></tr>`;
                }

                // Total Logic (Show total only if > 0 or explicit 0, otherwise hide on clean slate)
                // Actually, standard invoice always shows 0.00 if empty. But user requested "no entries".
                // We will show Total 0 if text fields are empty.
                const totalText = isLast ? `‚Çπ ${total}` : `<span class="text-sm italic font-normal text-gray-500">Continued...</span>`;

                const page = document.createElement('div');
                page.className = 'invoice-page';
                page.innerHTML = `
                    <div class="outer-pad">
                        <div class="border-box">
                            
                            <div>
                                <div class="flex justify-between items-start mb-2">
                                    <img src="https://raw.githubusercontent.com/Clean-Scripts/EasyGo-Expense-Tracker/refs/heads/main/logo.png" class="w-32 mt-2">
                                    <div class="text-center text-[10pt] leading-tight font-bold pt-1">
                                        <div>üìç : 114, Prime Square, Omaxe City 1 - Indore M.P.</div>
                                        <div>üìû : +91 7651837322, +91 92389 61346</div>
                                        <div>‚úâÔ∏è : Shibukochle@gmail.com | Website:</div>
                                        <div class="text-blue-900 text-[14pt] mt-1">GST: 23HAVPB1805E1ZZ</div>
                                    </div>
                                    <div class="text-right pt-1">
                                        <img src="https://github.com/Clean-Scripts/Easygo-Invoice/blob/main/easygo.com.png?raw=true" class="w-20 border-2 border-black inline-block">
                                    </div>
                                </div>

                                <h1 class="font-cinzel text-center text-[54px] tracking-[12px] my-2 leading-none">INVOICE</h1>

                                <div class="flex justify-between items-end mb-2 px-1">
                                    <div>
                                        <div class="font-cinzel font-bold text-lg leading-none mb-1">DATE ISSUED:</div>
                                        <div class="text-xl font-bold font-playfair leading-none mb-4">${data.date}</div>
                                        <div class="font-cinzel font-bold text-lg leading-none mb-1">INVOICE NO:</div>
                                        <div class="text-xl font-bold font-sans leading-none">${data.no}</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="font-cinzel font-bold text-lg leading-none mb-1">ISSUED TO:</div>
                                        <div class="text-2xl font-bold font-playfair leading-none mb-1">${data.to}</div>
                                        <div class="text-lg font-bold w-64 ml-auto whitespace-pre-line leading-tight text-right">${data.addr}</div>
                                    </div>
                                </div>

                                <table>
                                    <thead>
                                        <tr>
                                            <th class="w-12 text-center">S.No.</th>
                                            <th>DESCRIPTION</th>
                                            <th class="w-24 text-center">QTY</th>
                                            <th class="w-28 text-center">RATE</th>
                                            <th class="w-36 text-center">SUBTOTAL</th>
                                        </tr>
                                    </thead>
                                    <tbody>${rows}</tbody>
                                </table>

                                <div class="border-2 border-black border-t-0 flex">
                                    <div class="flex-grow text-right pr-4 py-2 font-cinzel font-bold text-xl tracking-widest flex items-center justify-end">GRAND TOTAL</div>
                                    <div class="w-36 border-l-2 border-black text-center py-2 font-bold font-sans text-2xl italic flex items-center justify-center">${totalText}</div>
                                </div>
                            </div>

                            <div class="pb-4">
                                <div class="flex items-end justify-between mt-2">
                                    <div class="w-[45%] text-[10pt] font-bold leading-snug">
                                        <div class="font-cinzel text-lg mb-1">PAYMENT DETAILS:</div>
                                        <div>Bank Name: Shibu Kochle</div>
                                        <div>Account No: 42708580348</div>
                                        <div>Account Type: Savings</div>
                                        <div>IFSC: SBIN0030450</div>
                                    </div>
                                    <div class="text-center">
                                        <img src="https://github.com/Clean-Scripts/Easygo-Invoice/blob/main/QrCode.jpeg?raw=true" class="w-24 h-24 border-2 border-black mx-auto">
                                        <div class="font-cinzel font-bold text-[10px] mt-1">SCAN TO PAY</div>
                                    </div>
                                    <div class="text-center w-40">
                                        <img src="https://github.com/Clean-Scripts/Easygo-Invoice/blob/main/invoice-sign.png?raw=true" class="w-32 mx-auto -mb-2">
                                        <div class="border-t-2 border-black w-full"></div>
                                        <div class="font-cinzel font-bold text-[10px] mt-1">SENDER'S SEAL & SIGN</div>
                                    </div>
                                </div>

                                <div class="h-8"></div> 

                                <div class="text-center font-cinzel font-bold text-xl tracking-[0.5em] uppercase mb-2">
                                    Thank You For Shopping!
                                </div>
                                
                                <div class="text-right text-[9pt] font-bold">Page ${pageNum} of ${chunks.length}</div>
                            </div>

                        </div>
                    </div>
                `;
                wrapper.appendChild(page);
            });
        }

        // Init
        renderItemsInput();
    </script>
</body>
</html>
